<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ร้านโก๋ป๊ะคะ กรุงเทพกรีฑา 7</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-blue: #30415d; /* Dark blue for main elements */
            --secondary-green: #4CAF50; /* A slightly darker green for highlights */
            --light-bg: #f5f7fa; /* Lighter background for overall page */
            --card-bg: #ffffff; /* White background for cards/sections */
            --text-dark: #333;
            --text-light: #f8f9fa;
            --border-color: #e0e6ed;
            --shadow-light: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-medium: 0 6px 16px rgba(0,0,0,0.1);
            --grey-text: #6c757d;

            /* Gradient for specific buttons/elements */
            --gradient-dark-blue: linear-gradient(to right, #0b0742, #120c6e);
            --gradient-dark-blue-hover: linear-gradient(to right, #120c6e, #0b0742);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Sarabun', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px; /* Adjust base font size */
        }

        .sidebar {
            width: 200px; /* More compact sidebar */
            background: var(--primary-blue);
            color: var(--text-light);
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-medium);
            position: fixed;
            height: 100%;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 1.2rem 1.5rem; /* Reduced padding */
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column; /* Stacked for name and location */
            align-items: flex-start; /* Align left */
            gap: 0.2rem;
        }

        .sidebar-header h2 {
            font-size: 1.3rem; /* Slightly smaller */
            margin: 0;
            font-weight: 700;
            white-space: nowrap;
        }

        .sidebar-header span {
            font-size: 0.8rem; /* Smaller for location */
            color: rgba(255,255,255,0.7);
            white-space: nowrap;
        }

        .sidebar-nav {
            flex-grow: 1;
            padding: 0 0.8rem; /* Reduced padding */
        }

        .sidebar-nav button {
            background: transparent; /* No gradient by default */
            border: none;
            color: var(--text-light);
            text-align: left;
            font-size: 0.95rem; /* Slightly smaller font */
            padding: 0.7rem 1rem; /* Adjust padding */
            width: 100%;
            cursor: pointer;
            border-radius: 8px; /* More rounded buttons */
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transition: all 0.3s ease; /* Smooth transition for hover */
            margin-bottom: 0.5rem; /* Space between buttons */
            font-weight: normal; /* Default font weight */
        }

        .sidebar-nav button:hover,
        .sidebar-nav button.active {
            background: #0b0742; /* Dark blue on hover/active */
            font-weight: bold; /* Bold on hover/active */
            transform: translateY(-1px); /* Slight lift effect */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .sidebar-nav button.active {
            box-shadow: 0 4px 8px rgba(0,0,0,0.25); /* More pronounced shadow for active */
        }

        .sidebar-nav button i {
            font-size: 1.0rem; /* Slightly smaller icon */
            width: 20px;
            text-align: center;
        }

        .main-content {
            margin-left: 200px; /* Offset for the fixed sidebar */
            flex-grow: 1;
            padding: 1.5rem; /* Reduced overall padding */
            display: flex;
            flex-direction: column;
        }

        .header-bar {
            background: var(--card-bg);
            padding: 0.8rem 1.5rem; /* Adjusted padding */
            margin: -1.5rem -1.5rem 1.5rem -1.5rem; /* Pull it to the edges of main-content */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 6px rgba(0,0,0,0.05);
            z-index: 999;
            height: 55px; /* Slightly reduced height for header */
        }

        .header-bar h1 {
            margin: 0;
            font-size: 1.3rem; /* Slightly smaller header title */
            color: var(--primary-blue);
            font-weight: 700;
            display: flex; /* Allow icon next to text */
            align-items: center;
            gap: 0.6rem;
        }

        .header-bar h1 i {
            font-size: 1.1em; /* Make icon slightly larger than text */
        }

        .current-date-display {
            background-color: var(--secondary-green); /* Green background for date */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            flex-grow: 1;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        .action-bar button, .action-bar select, .action-bar input {
            padding: 0.6rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--light-bg);
            font-family: 'Sarabun', sans-serif;
            color: var(--text-dark);
            font-size: 0.9rem;
        }
        .action-bar button {
            background: var(--secondary-green);
            color: white;
            cursor: pointer;
            border: none;
            transition: background 0.2s ease;
        }
        .action-bar button:hover {
            background: #449d48; /* Darker green on hover */
        }

        .data-table-container {
            background: var(--card-bg);
            padding: 1.2rem; /* Adjusted padding */
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            overflow-x: auto;
            margin-top: 1.5rem; /* Space from elements above */
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th, .data-table td {
            padding: 0.7rem 1rem; /* Adjusted padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .data-table th {
            background: var(--light-bg);
            font-weight: bold;
            color: var(--primary-blue);
            font-size: 0.9rem; /* Slightly smaller font */
        }
        .data-table td {
            font-size: 0.85rem; /* Slightly smaller font */
        }
        .data-table tbody tr:last-child td {
            border-bottom: none;
        }
        .data-table button {
            padding: 0.4rem 0.7rem; /* Adjusted padding */
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.8rem; /* Adjusted font size */
            transition: background 0.2s ease;
        }
        .data-table button.edit-btn {
            background: #007bff;
            color: white;
        }
        .data-table button.edit-btn:hover {
            background: #0056b3;
        }
        .data-table button.delete-btn {
            background: #dc3545;
            color: white;
            margin-left: 0.5rem;
        }
        .data-table button.delete-btn:hover {
            background: #b02a37;
        }

        /* Specific for Sales Tab (Order List) */
        .sales-layout {
            display: flex;
            gap: 1.5rem;
            flex-grow: 1;
        }

        .product-selection-section {
            flex: 2;
            display: flex;
            flex-direction: column;
        }

        .product-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); /* Slightly smaller product cards */
            gap: 0.8rem; /* Reduced gap */
            margin-bottom: 1.2rem; /* Adjusted margin */
            background: var(--card-bg);
            padding: 1.2rem; /* Adjusted padding */
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            flex-grow: 1; /* Allow grid to grow */
            overflow-y: auto; /* Enable scrolling for product list */
            max-height: calc(100vh - 200px); /* Adjust max-height based on viewport and header/footer */
        }

        .category-header-tab { /* New style for category headers in sales tab */
            grid-column: 1 / -1; /* Span full width */
            background: var(--gradient-dark-blue); /* Apply gradient */
            color: var(--text-light);
            padding: 0.6rem 1rem; /* Padding for the tab */
            border-radius: 8px; /* Rounded corners for the tab */
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: bold;
            text-align: left;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .product-item {
            background: var(--light-bg);
            padding: 0.8rem; /* Adjusted padding */
            border-radius: 8px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .product-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .product-item h4 {
            margin: 0 0 0.4rem 0; /* Adjusted margin */
            font-size: 0.95rem; /* Adjusted font size */
            color: var(--primary-blue);
        }
        .product-item p {
            margin: 0;
            font-size: 0.8rem; /* Adjusted font size */
            color: var(--grey-text);
        }
        .product-item .qty-controls {
            display: flex;
            align-items: center;
            gap: 0.4rem; /* Reduced gap */
            margin-top: 0.7rem; /* Adjusted margin */
        }
        .product-item .qty-controls button {
            width: 28px; /* Slightly smaller buttons */
            height: 28px;
            background: #120c6e; /* Changed to #120c6e */
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.1rem; /* Adjusted font size */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .product-item .qty-controls button:hover {
            background: #0b0742; /* Darker blue on hover */
        }
        .product-item .qty-display {
            font-weight: bold;
            font-size: 1.0rem; /* Adjusted font size */
            color: var(--text-dark);
            min-width: 20px;
        }

        .order-summary-sales-tab {
            flex: 1;
            background: var(--card-bg);
            padding: 1.2rem; /* Adjusted padding */
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            display: flex;
            flex-direction: column;
        }
        .order-summary-sales-tab h3 {
            margin-top: 0;
            color: var(--primary-blue);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .order-summary-sales-tab table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            flex-grow: 1; /* Allow table to grow */
            overflow-y: auto; /* Enable scrolling for order list */
            max-height: 250px; /* Limit height for scrollable area */
        }
        .order-summary-sales-tab th, .order-summary-sales-tab td {
            padding: 0.5rem 0; /* Adjusted padding */
            text-align: left;
            border-bottom: 1px dashed var(--border-color);
            font-size: 0.85rem;
        }
        .order-summary-sales-tab th {
            font-size: 0.9rem;
            color: var(--primary-blue);
        }
        .order-summary-sales-tab td:last-child {
            text-align: right; /* Align price to right */
        }
        .order-summary-sales-tab .total-row {
            font-weight: bold;
            font-size: 1.0rem;
            color: var(--primary-blue);
            text-align: right;
            padding-top: 0.8rem;
            border-top: 1px solid var(--border-color); /* Separator for total */
        }

        /* Finalize Order Dropdown Styles */
        .finalize-dropdown-container {
            position: relative;
            width: 100%;
            margin-top: 1rem;
        }

        .finalize-dropdown-button {
            width: 100%;
            padding: 0.9rem;
            background: var(--secondary-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }
        .finalize-dropdown-button:hover {
            background: #449d48;
        }

        .finalize-dropdown-content {
            display: none;
            position: absolute;
            bottom: 100%; /* Position above the button */
            left: 0;
            width: 100%;
            background-color: var(--card-bg);
            box-shadow: 0 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden; /* Ensure rounded corners apply to children */
            margin-bottom: 0.5rem; /* Space between dropdown and button */
        }

        .finalize-dropdown-content button {
            color: var(--text-dark);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.95rem;
            transition: background-color 0.2s ease;
        }

        .finalize-dropdown-content button:hover {
            background-color: var(--light-bg);
        }

        .finalize-dropdown-container.show .finalize-dropdown-content {
            display: block;
        }

        /* Confirmation Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            padding: 1rem;
        }
        .modal.active { /* Show when active */
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow-medium);
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-content h3 {
            color: var(--primary-blue);
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .modal-info p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .modal-info strong {
            font-size: 1.3rem;
            color: var(--secondary-green);
        }

        .modal-input-group {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .modal-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--primary-blue);
        }
        .modal-input-group input {
            width: 80%;
            max-width: 200px;
            padding: 0.8rem;
            font-size: 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            text-align: center;
            font-family: 'Sarabun', sans-serif;
        }
        .modal-input-group .change-display {
            margin-top: 1rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: #d82d61; /* Red for change */
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .modal-actions button {
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background 0.2s ease;
        }
        .modal-actions .confirm-btn {
            background-color: var(--secondary-green);
            color: white;
        }
        .modal-actions .confirm-btn:hover {
            background-color: #449d48;
        }
        .modal-actions .cancel-btn {
            background-color: #6c757d;
            color: white;
        }
        .modal-actions .cancel-btn:hover {
            background-color: #5a6268;
        }


        /* Menu Management Specific Styles */
        .menu-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjusted min-width */
            gap: 1.2rem; /* Reduced gap */
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow-light);
        }
        .menu-form-grid label {
            display: block;
            margin-bottom: 0.4rem; /* Reduced margin */
            font-weight: bold;
            color: var(--primary-blue);
            font-size: 0.9rem;
        }
        .menu-form-grid input, .menu-form-grid select {
            width: 100%;
            padding: 0.7rem; /* Adjusted padding */
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Sarabun', sans-serif;
            font-size: 0.9rem;
            background: var(--light-bg);
            color: var(--text-dark);
        }
        .menu-form-grid button {
            grid-column: span 2; /* Make the button span two columns on larger screens */
            padding: 0.9rem; /* Adjusted padding */
            background: var(--gradient-dark-blue); /* Apply gradient */
            color: white;
            border: none;
            border-radius: 8px; /* Apply rounded corners */
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease; /* Smooth transition */
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .menu-form-grid button:hover {
            background: var(--gradient-dark-blue-hover); /* Invert gradient on hover */
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* Reports Tab Pie Chart Specific Styles */
        .report-chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            flex-wrap: wrap;
            gap: 2rem;
        }
        .pie-chart-wrapper {
            position: relative;
            width: 180px; /* Slightly smaller chart */
            height: 180px;
            border-radius: 50%;
            background: conic-gradient(transparent 0deg);
            flex-shrink: 0;
            border: 2px solid var(--border-color); /* Added border to chart */
        }
        .pie-chart-center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px; /* Adjusted size */
            height: 90px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem; /* Adjusted font size */
            font-weight: bold;
            color: var(--primary-blue);
            text-align: center;
            padding: 5px;
            box-sizing: border-box;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05); /* Inner shadow */
        }
        .chart-legend {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.4rem; /* Reduced gap */
            max-height: 180px; /* Constrain height to match chart */
            overflow-y: auto;
        }
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem; /* Adjusted font size */
            color: var(--text-dark);
            white-space: nowrap;
        }
        .legend-color-box {
            width: 14px; /* Adjusted size */
            height: 14px;
            border-radius: 3px;
            margin-right: 0.6rem; /* Adjusted margin */
            flex-shrink: 0;
        }
        .legend-text {
            flex-grow: 1;
        }
        .legend-value {
            font-weight: bold;
            margin-left: 0.4rem;
        }

        .report-summary p {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }
        .report-summary strong {
            color: var(--primary-blue);
        }

        /* New style for action buttons in reports tab */
        .report-actions-container {
            display: flex;
            gap: 1rem; /* Space between buttons */
            margin-top: 1rem;
            justify-content: flex-end; /* Align buttons to the right */
        }

        .report-action-btn {
            padding: 0.8rem 1.5rem; /* Make it bigger */
            border-radius: 8px; /* Consistent rounded corners */
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background 0.2s ease;
            color: white; /* White font */
        }

        .report-action-btn.clear-btn {
            background: #dc3545; /* Red */
        }
        .report-action-btn.clear-btn:hover {
            background: #b02a37; /* Darker red on hover */
        }

        .report-action-btn.export-btn {
            background: #007bff; /* Blue for export */
        }
        .report-action-btn.export-btn:hover {
            background: #0056b3; /* Darker blue on hover */
        }


        /* Responsive adjustments */
        @media (max-width: 992px) {
            .sidebar {
                width: 65px; /* Even smaller collapsed sidebar */
                padding-top: 0.5rem;
            }
            .sidebar-header {
                padding: 0.5rem 0;
                margin-bottom: 0.5rem;
            }
            .sidebar-header h2 {
                font-size: 1.2rem;
                text-align: center;
                width: 100%;
            }
            .sidebar-header span {
                display: none;
            }
            .sidebar-nav {
                padding: 0 0.2rem;
            }
            .sidebar-nav button {
                justify-content: center;
                padding: 0.7rem 0;
                border-radius: 6px;
            }
            .sidebar-nav button span {
                display: none;
            }
            .sidebar-nav button i {
                margin: 0; /* Center icon */
            }
            .main-content {
                margin-left: 65px;
                padding: 1rem;
            }
            .header-bar {
                padding: 0.7rem 1rem;
                margin: -1rem -1rem 1rem -1rem;
                height: 50px;
            }
            .header-bar h1 {
                font-size: 1.1rem;
            }
            .current-date-display {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                gap: 0.4rem;
            }
            .menu-form-grid {
                grid-template-columns: 1fr;
            }
            .menu-form-grid button {
                grid-column: span 1;
            }
            .report-chart-container {
                flex-direction: column;
                align-items: center;
            }
            .modal-content {
                padding: 1.5rem;
            }
            .modal-content h3 {
                font-size: 1.2rem;
                margin-bottom: 1rem;
            }
            .modal-info p {
                font-size: 1rem;
            }
            .modal-info strong {
                font-size: 1.1rem;
            }
            .modal-input-group input {
                padding: 0.6rem;
                font-size: 1rem;
            }
            .modal-input-group .change-display {
                font-size: 1rem;
            }
            .modal-actions button {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
            .report-actions-container {
                flex-direction: column; /* Stack buttons on smaller screens */
                align-items: stretch; /* Stretch buttons to full width */
            }
        }

        @media (max-width: 768px) {
            .sales-layout {
                flex-direction: column; /* Stack sales sections */
            }
            .product-selection-section {
                flex: none; /* Remove flex basis */
                width: 100%;
            }
            .order-summary-sales-tab {
                flex: none; /* Remove flex basis */
                width: 100%;
            }
            .product-selection-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* Even smaller for mobile */
                max-height: 400px; /* Limit height on small screens to allow scrolling */
                padding: 0.8rem; /* Reduced padding */
            }
            .product-item {
                padding: 0.6rem; /* Reduced padding for product items */
            }
            .product-item h4 {
                font-size: 0.9rem; /* Smaller font for menu name */
            }
            .product-item p {
                font-size: 0.75rem; /* Smaller font for price */
            }
            .product-item .qty-controls button {
                width: 24px; /* Even smaller buttons */
                height: 24px;
                font-size: 1rem;
            }
            .product-item .qty-display {
                font-size: 0.9rem;
            }
            .order-summary-sales-tab table {
                max-height: 200px; /* Adjust height for order summary table on small screens */
            }
            .data-table-container {
                padding: 0.8rem;
            }
            .data-table th, .data-table td {
                padding: 0.6rem 0.5rem;
                font-size: 0.8rem;
            }
            .data-table button {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ร้านโก๋ป๊ะคะ</h2>
            <span>กรุงเทพกรีฑา 7</span>
        </div>
        <div class="sidebar-nav">
            <button class="active" onclick="switchTab('sales-tab')">
                <i class="fas fa-shopping-cart"></i> <span>รายการขาย</span>
            </button>
            <button onclick="switchTab('products-tab')">
                <i class="fas fa-box-open"></i> <span>สินค้า</span>
            </button>
            <button onclick="switchTab('reports-tab')">
                <i class="fas fa-chart-line"></i> <span>สรุปยอดวันนี้</span>
            </button>
        </div>
    </div>

    <div class="main-content">
        <div class="header-bar">
            <h1 id="currentPageTitle"></h1> 
            <div class="current-date-display">
                <i class="fas fa-calendar-alt"></i>
                <span id="displayDate"></span>
            </div>
        </div>

        <div id="sales-tab" class="tab-content active">
            <div class="sales-layout">
                <div class="product-selection-section">
                    <div class="product-selection-grid" id="productSelectionContainer">
                        </div>
                </div>
                <div class="order-summary-sales-tab">
                    <h3>รายการที่เลือก</h3>
                    <table id="orderTableSalesTab">
                        <thead>
                            <tr><th>เมนู</th><th>จำนวน</th><th style="text-align:right;">ราคารวม</th></tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                    <div class="total-row">
                        รวมทั้งหมด: <strong id="totalAmountSalesTab">0</strong> บาท
                    </div>
                    <div class="finalize-dropdown-container">
                        <button class="finalize-dropdown-button" onclick="toggleFinalizeDropdown(event)">
                            สรุปรายการและชำระเงิน <i class="fas fa-caret-down"></i>
                        </button>
                        <div class="finalize-dropdown-content">
                            <button onclick="showFinalizeConfirmation('cash')">จ่ายด้วยเงินสด</button>
                            <button onclick="showFinalizeConfirmation('qr_code')">สแกนจ่าย QR Code</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="products-tab" class="tab-content">
            <div class="menu-form-grid">
                <div>
                    <label for="menuCategorySelect">หมวดหมู่:</label>
                    <select id="menuCategorySelect" onchange="toggleNewCategoryInput()">
                        </select>
                    <input type="text" id="newCategoryInput" placeholder="เพิ่มหมวดหมู่ใหม่" style="display: none; margin-top: 0.5rem;">
                </div>
                <div>
                    <label for="menuName">ชื่อเมนู:</label>
                    <input type="text" id="menuName" placeholder="เช่น โก๋ดั้งเดิม">
                </div>
                <div>
                    <label for="menuPrice">ราคา:</label>
                    <input type="number" id="menuPrice" min="0" value="0">
                </div>
                <button onclick="addMenuItem()">เพิ่มเมนูใหม่</button>
            </div>

            <div class="data-table-container">
                <h4>รายการเมนูปัจจุบัน</h4>
                <table class="data-table" id="currentMenuTable">
                    <thead>
                        <tr>
                            <th>หมวดหมู่</th>
                            <th>ชื่อเมนู</th>
                            <th>ราคา (บาท)</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="menuListTableBody">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="reports-tab" class="tab-content">
            <div class="report-chart-container">
                <div class="pie-chart-wrapper" id="bestSellerPieChart">
                    <div class="pie-chart-center-circle"></div>
                </div>
                <ul class="chart-legend" id="bestSellerLegend">
                    </ul>
            </div>

            <div class="data-table-container">
                <div class="report-summary" style="margin-bottom: 1.5rem;">
                    <p><strong>ยอดขายรวมทั้งหมด:</strong> <span id="totalSalesAmount">0</span> บาท</p>
                    <p><strong>ยอดขายเงินสดรวม:</strong> <span id="totalCashSalesAmount">0</span> บาท</p>
                    <p><strong>ยอดขายสแกน QR Code รวม:</strong> <span id="totalQrCodeSalesAmount">0</span> บาท</p>
                    <p><strong>จำนวนรายการที่ขาย:</strong> <span id="totalSalesCount">0</span> รายการ</p>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>เมนู</th>
                            <th>จำนวนที่ขาย</th>
                            <th>รวม (บาท)</th>
                        </tr>
                    </thead>
                    <tbody id="salesReportTableBody">
                        </tbody>
                </table>
                <div class="report-actions-container">
                    <button class="report-action-btn clear-btn" onclick="clearDailyReport()">ล้างข้อมูลสรุปวันนี้</button>
                    <button class="report-action-btn export-btn" onclick="exportDailyReportToCsv()">ส่งออกข้อมูล (CSV)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="finalizeModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">สรุปรายการและชำระเงิน</h3>
            <div class="modal-info">
                <p>ยอดรวมสุทธิ: <strong id="modalTotalAmount">0</strong> บาท</p>
                <p>วิธีการชำระเงิน: <span id="modalPaymentMethod"></span></p>
            </div>
            <div id="cashInputGroup" class="modal-input-group" style="display: none;">
                <label for="amountReceived">เงินที่ได้รับ (บาท):</label>
                <input type="number" id="amountReceived" min="0" value="0" oninput="calculateChange()">
                <p class="change-display">เงินทอน: <span id="changeAmount">0</span> บาท</p>
            </div>
            <div class="modal-actions">
                <button class="confirm-btn" onclick="confirmFinalizeOrder()">ยืนยันการชำระเงิน</button>
                <button class="cancel-btn" onclick="closeFinalizeModal()">ยกเลิก</button>
            </div>
        </div>
    </div>

    <script>
        // Initial product data - UPDATED MENU
        let products = JSON.parse(localStorage.getItem('menuItems')) || [
            { category: "ปาท่องโก๋", items: [
                { name: "โก๋ดั้งเดิม", price: 10 },
                { name: "ไส้กรอกไก่", price: 20 },
                { name: "โก๋เกลี้ยว", price: 10 },
                { name: "โก๋โฮลวีต", price: 10 },
                { name: "โก๋กล้วยหอม", price: 10 },
                { name: "โก๋ซินนาม่อน", price: 10 },
                { name: "โก๋ชาร์โคล", price: 10 },
                { name: "โก๋รวม", price: 10 },
                { name: "ทาร์ตไข่", price: 18 }
            ] },
            { category: "เครื่องดื่ม", items: [
                { name: "น้ำเต้าหู้ ไม่ใส่เครื่อง", price: 7 },
                { name: "ชาดำเย็น", price: 10 },
                { name: "เก๊กฮวย", price: 10 },
                { name: "โอเลี้ยง", price: 10 },
                { name: "กาแฟโบราณ", price: 15 },
                { name: "ชาไทย", price: 15 }
            ] },
            { category: "ดิปปิ้ง", items: [
                { name: "สังขยาใบเตย", price: 10 },
                { name: "นมข้นหวาน", price: 10 },
                { name: "แยมสตรอเบอร์รี่", price: 10 },
                { name: "แยมบลูเบอร์รี่", price: 10 }
            ] }
        ];

        // Updated dailyReport structure to track payment methods
        let dailyReport = JSON.parse(localStorage.getItem('dailyReport')) || {
            totalCashSales: 0,
            totalQrCodeSales: 0,
            itemSales: {} // Aggregates item quantities and prices regardless of payment method
        };

        const order = {}; // Current order in 'sales' tab
        let currentPaymentMethod = ''; // To store the selected payment method for the modal

        // Map tab IDs to their display titles and icons for the header
        const pageInfo = {
            'sales-tab': { title: 'รายการขาย', icon: 'fas fa-shopping-cart' },
            'products-tab': { title: 'จัดการเมนูสินค้า', icon: 'fas fa-box-open' },
            'reports-tab': { title: 'สรุปยอดวันนี้', icon: 'fas fa-chart-line' }
        };

        // Predefined color palette for the pie chart
        const pieChartColors = [
            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',
            '#858796', '#17a2b8', '#fd7e14', '#6f42c1', '#20c997',
            '#6610f2', '#6c757d', '#ffc107', '#28a745', '#dc3545',
            '#007bff', '#fd7e14', '#e83e8c', '#6f42c1', '#20c997'
        ];

        function getThaiDate(date) {
            const dayOfWeek = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
            const monthNames = [
                'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',
                'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'
            ];

            const d = new Date(date);
            const day = d.getDate();
            const month = monthNames[d.getMonth()];
            const year = d.getFullYear() + 543; // Buddhist Era
            const dayText = dayOfWeek[d.getDay()];

            return `วัน${dayText}ที่ ${day} ${month} ${year}`;
        }

        function updateCurrentDate() {
            const today = new Date();
            document.getElementById('displayDate').textContent = getThaiDate(today);
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.sidebar-nav button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.sidebar-nav button[onclick*="${tabId}"]`).classList.add('active');
           
            // Update header title and icon
            const headerTitleElement = document.getElementById('currentPageTitle');
            const info = pageInfo[tabId];
            if (info) {
                headerTitleElement.innerHTML = `<i class="${info.icon}"></i> <span>${info.title}</span>`;
            } else {
                headerTitleElement.innerHTML = `<span>${tabId}</span>`; // Fallback
            }

            // Re-render content when switching tabs
            if (tabId === 'sales-tab') {
                renderProductsForSales(); // Always re-render products to reflect menu changes
                renderOrderForSalesTab();
            } else if (tabId === 'reports-tab') {
                renderDailyReport();
                renderBestSellerPieChart(); // Call the new pie chart rendering function
            } else if (tabId === 'products-tab') {
                populateCategoryDropdown(); // Populate dropdown when navigating to products tab
                renderMenuList(); // Always re-render menu list
            }
            // Close dropdown if open when switching tabs
            const dropdownContainer = document.querySelector('.finalize-dropdown-container');
            if (dropdownContainer && dropdownContainer.classList.contains('show')) {
                dropdownContainer.classList.remove('show');
            }
            closeFinalizeModal(); // Also close modal if open
        }

        // --- Sales Tab Functions (รายการขาย) ---
        function renderProductsForSales() {
            const container = document.getElementById("productSelectionContainer");
            container.innerHTML = "";
            products.forEach(group => {
                // Only render category header if there are items in it
                if (group.items.length > 0) {
                    const categoryHeader = document.createElement("div"); // Changed to div for styling
                    categoryHeader.className = "category-header-tab"; // Apply new class
                    categoryHeader.textContent = group.category;
                    container.appendChild(categoryHeader);

                    group.items.forEach(item => {
                        const p = document.createElement("div");
                        p.className = "product-item";
                        // Ensure special characters in name are escaped for JS string literal
                        const escapedName = item.name.replace(/'/g, "\\'"); 
                        const currentQty = order[item.name] ? order[item.name].qty : 0;
                        p.innerHTML = `
                            <div>
                                <h4>${item.name}</h4>
                                <p>${item.price} บาท</p>
                            </div>
                            <div class="qty-controls">
                                <button onclick="removeItemFromOrder('${escapedName}')">-</button>
                                <span class="qty-display" id="qty-${item.name.replace(/\s/g, '-')}-sales">${currentQty}</span>
                                <button onclick="addItemToOrder('${escapedName}', ${item.price})">+</button>
                            </div>`;
                        container.appendChild(p);
                    });
                }
            });
        }

        function addItemToOrder(name, price) {
            if (!order[name]) {
                order[name] = { qty: 0, price };
            }
            order[name].qty++;
            renderOrderForSalesTab();
        }

        function removeItemFromOrder(name) {
            if (order[name]) {
                order[name].qty--;
                if (order[name].qty <= 0) delete order[name];
                renderOrderForSalesTab();
            }
        }

        function renderOrderForSalesTab() {
            const tbody = document.querySelector("#orderTableSalesTab tbody");
            tbody.innerHTML = "";
            let total = 0;
            Object.entries(order).forEach(([name, { qty, price }]) => {
                const tr = document.createElement("tr");
                const subtotal = qty * price;
                tr.innerHTML = `<td>${name}</td><td>${qty}</td><td style="text-align:right;">${subtotal}</td>`;
                tbody.appendChild(tr);
                total += subtotal;

                // Update quantity display on product cards
                const qtyDisplay = document.getElementById(`qty-${name.replace(/\s/g, '-')}-sales`);
                if (qtyDisplay) {
                    qtyDisplay.textContent = qty;
                }
            });
            document.getElementById("totalAmountSalesTab").textContent = total;

            // Clear quantity displays for items no longer in order
            document.querySelectorAll('.qty-display').forEach(el => {
                // Convert id back to original name for lookup
                const itemNameFromId = el.id.replace('qty-', '').replace('-sales', '').replace(/-/g, ' ');
                // Check if the item still exists in the order or if its quantity is 0
                if (!order[itemNameFromId] || order[itemNameFromId].qty === 0) {
                    el.textContent = '0';
                }
            });
        }

        function toggleFinalizeDropdown(event) {
            event.stopPropagation(); // Prevent document click from closing immediately
            document.querySelector('.finalize-dropdown-container').classList.toggle('show');
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
            if (!event.target.matches('.finalize-dropdown-button') && !event.target.closest('.finalize-dropdown-content')) {
                const dropdowns = document.getElementsByClassName("finalize-dropdown-content");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.parentElement.classList.contains('show')) {
                        openDropdown.parentElement.classList.remove('show');
                    }
                }
            }
            // Close modal if clicking outside it
            const modal = document.getElementById('finalizeModal');
            if (event.target == modal) {
                closeFinalizeModal();
            }
        }

        function showFinalizeConfirmation(paymentMethod) {
            const total = parseFloat(document.getElementById("totalAmountSalesTab").textContent);
            if (total === 0) {
                alert("ยังไม่มีรายการสั่งซื้อ");
                closeFinalizeModal(); // Ensure modal is closed if empty order
                document.querySelector('.finalize-dropdown-container').classList.remove('show'); // Close dropdown
                return;
            }

            currentPaymentMethod = paymentMethod;
            document.getElementById('modalTotalAmount').textContent = total;
            document.getElementById('modalPaymentMethod').textContent = (paymentMethod === 'cash' ? 'เงินสด' : 'สแกนจ่าย QR Code');

            const cashInputGroup = document.getElementById('cashInputGroup');
            if (paymentMethod === 'cash') {
                cashInputGroup.style.display = 'block';
                document.getElementById('amountReceived').value = total; // Pre-fill with total
                calculateChange(); // Calculate initial change
            } else {
                cashInputGroup.style.display = 'none';
            }

            document.getElementById('finalizeModal').classList.add('active'); // Show modal
            document.querySelector('.finalize-dropdown-container').classList.remove('show'); // Close the dropdown
        }

        function calculateChange() {
            const total = parseFloat(document.getElementById('modalTotalAmount').textContent);
            const amountReceived = parseFloat(document.getElementById('amountReceived').value) || 0;
            const change = amountReceived - total;
            document.getElementById('changeAmount').textContent = Math.max(0, change).toFixed(2); // Ensure non-negative change
        }

        function closeFinalizeModal() {
            document.getElementById('finalizeModal').classList.remove('active');
            document.getElementById('amountReceived').value = 0; // Reset input
            document.getElementById('changeAmount').textContent = '0'; // Reset change
        }

        function confirmFinalizeOrder() {
            // This is the first line inside the function. If you don't see this, the click handler itself isn't firing.
            console.log("confirmFinalizeOrder called!"); 
            const total = parseFloat(document.getElementById("modalTotalAmount").textContent);
            const paymentMethod = currentPaymentMethod;
            console.log("Total:", total, "Payment Method:", paymentMethod);

            if (paymentMethod === 'cash') {
                const amountReceivedInput = document.getElementById('amountReceived');
                const amountReceived = parseFloat(amountReceivedInput.value) || 0;
                console.log("Amount Received (parsed):", amountReceived); // Log parsed amount

                if (amountReceived < total) {
                    alert("เงินที่ได้รับไม่เพียงพอ! กรุณาใส่จำนวนเงินที่ได้รับให้ครบถ้วน"); // More explicit message
                    amountReceivedInput.focus(); // Keep focus on the input
                    return; // Stop execution if amount is insufficient
                }
            }

            // Update daily report (item sales)
            for (const itemName in order) {
                if (dailyReport.itemSales[itemName]) {
                    dailyReport.itemSales[itemName].qty += order[itemName].qty;
                    dailyReport.itemSales[itemName].totalPrice += (order[itemName].qty * order[itemName].price);
                } else {
                    dailyReport.itemSales[itemName] = {
                        qty: order[itemName].qty,
                        totalPrice: (order[itemName].qty * order[itemName].price)
                    };
                }
            }

            // Update daily report (payment method totals)
            if (paymentMethod === 'cash') {
                dailyReport.totalCashSales += total;
            } else if (paymentMethod === 'qr_code') {
                dailyReport.totalQrCodeSales += total;
            }
            
            localStorage.setItem('dailyReport', JSON.stringify(dailyReport));

            alert(`บันทึกคำสั่งซื้อเรียบร้อยแล้ว ชำระด้วย: ${paymentMethod === 'cash' ? 'เงินสด' : 'QR Code'}`);
            
            // Clear the current order
            Object.keys(order).forEach(k => delete order[k]);
            renderOrderForSalesTab(); // This will clear the table and reset quantities to 0
            closeFinalizeModal(); // Close the modal after finalizing
        }

        // --- Reports Tab Functions (สรุปยอดวันนี้) ---
        function renderDailyReport() {
            const tbody = document.getElementById("salesReportTableBody");
            tbody.innerHTML = "";
            let totalSalesAmount = 0;
            let totalSalesCount = 0;

            // Sort dailyReport.itemSales keys alphabetically for consistent display
            const sortedItemNames = Object.keys(dailyReport.itemSales).sort();

            sortedItemNames.forEach(itemName => {
                const item = dailyReport.itemSales[itemName];
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${itemName}</td><td>${item.qty}</td><td>${item.totalPrice}</td>`;
                tbody.appendChild(tr);
                totalSalesAmount += item.totalPrice;
                totalSalesCount += item.qty;
            });

            document.getElementById("totalSalesAmount").textContent = totalSalesAmount;
            document.getElementById("totalSalesCount").textContent = totalSalesCount;
            document.getElementById("totalCashSalesAmount").textContent = dailyReport.totalCashSales;
            document.getElementById("totalQrCodeSalesAmount").textContent = dailyReport.totalQrCodeSales;
        }

        function clearDailyReport() {
            if (confirm("คุณแน่ใจหรือไม่ที่ต้องการล้างข้อมูลสรุปวันนี้ทั้งหมด?")) {
                dailyReport = {
                    totalCashSales: 0,
                    totalQrCodeSales: 0,
                    itemSales: {}
                };
                localStorage.setItem('dailyReport', JSON.stringify(dailyReport)); // Save empty report
                renderDailyReport();
                renderBestSellerPieChart(); // Clear the pie chart as well
                alert("ข้อมูลสรุปวันนี้ถูกล้างเรียบร้อยแล้ว");
            }
        }

        function exportDailyReportToCsv() {
            const todayDate = document.getElementById('displayDate').textContent; // Get formatted date
            const filename = `รายงานยอดขาย-${todayDate}.csv`;

            let csvContent = "data:text/csv;charset=utf-8,%EF%BB%BF"; // BOM for UTF-8 in Excel

            // Helper function to quote fields for CSV
            const quoteField = (field) => {
                let s = String(field);
                // Escape existing double quotes by doubling them
                s = s.replace(/"/g, '""');
                // Quote the field if it contains comma, newline, or a double quote
                if (s.includes(',') || s.includes('\n') || s.includes('\r') || s.includes('"')) {
                    return `"${s}"`;
                }
                return s;
            };

            // Summary Section
            csvContent += quoteField("รายงานสรุปยอดขายประจำวัน") + "\n";
            csvContent += quoteField("วันที่ส่งออก:") + "," + quoteField(todayDate) + "\n";
            csvContent += "\n"; // Empty line for separation

            csvContent += quoteField("ยอดขายรวมทั้งหมด:") + "," + quoteField(document.getElementById("totalSalesAmount").textContent) + "\n";
            csvContent += quoteField("ยอดขายเงินสดรวม:") + "," + quoteField(document.getElementById("totalCashSalesAmount").textContent) + "\n";
            csvContent += quoteField("ยอดขายสแกน QR Code รวม:") + "," + quoteField(document.getElementById("totalQrCodeSalesAmount").textContent) + "\n";
            csvContent += quoteField("จำนวนรายการที่ขาย:") + "," + quoteField(document.getElementById("totalSalesCount").textContent) + "\n";
            csvContent += "\n"; // Empty line for separation

            // Detailed Item Sales Section
            csvContent += quoteField("รายการเมนูที่ขาย:") + "\n";
            csvContent += quoteField("เมนู") + "," + quoteField("จำนวนที่ขาย") + "," + quoteField("รวม (บาท)") + "\n";

            const sortedItemNames = Object.keys(dailyReport.itemSales).sort();
            sortedItemNames.forEach(itemName => {
                const item = dailyReport.itemSales[itemName];
                csvContent += quoteField(itemName) + "," + quoteField(item.qty) + "," + quoteField(item.totalPrice) + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link); // Clean up
        }


        function renderBestSellerPieChart() {
            const chartWrapper = document.getElementById('bestSellerPieChart');
            const legendContainer = document.getElementById('bestSellerLegend');
            const centerCircle = chartWrapper.querySelector('.pie-chart-center-circle');

            legendContainer.innerHTML = ''; // Clear previous legend

            const salesData = Object.entries(dailyReport.itemSales).map(([name, data]) => ({
                name: name,
                totalSold: data.qty // We'll base "best seller" on quantity sold
            }));

            // Filter out items with 0 sales and sort by totalSold (descending)
            const validSalesData = salesData.filter(item => item.totalSold > 0).sort((a, b) => b.totalSold - a.totalSold);

            if (validSalesData.length === 0) {
                chartWrapper.style.background = 'conic-gradient(#e0e0e0 0deg 360deg)'; // Grey circle for no data
                centerCircle.textContent = 'ไม่มีข้อมูล';
                return;
            }

            const totalQuantitySold = validSalesData.reduce((sum, item) => sum + item.totalSold, 0);

            let conicGradientString = '';
            let currentAngle = 0;
            let largestSlicePercentage = 0;
            let largestSliceName = '';
            
            validSalesData.forEach((item, index) => {
                const percentage = (item.totalSold / totalQuantitySold);
                const angle = percentage * 360;
                const color = pieChartColors[index % pieChartColors.length]; // Cycle through colors

                conicGradientString += `${color} ${currentAngle}deg ${currentAngle + angle}deg`;
                if (index < validSalesData.length - 1) {
                    conicGradientString += ', ';
                }
                currentAngle += angle;

                // Update largest slice info (still based on percentage for the "largest" definition)
                if (percentage > largestSlicePercentage) {
                    largestSlicePercentage = percentage;
                    largestSliceName = item.name;
                }

                // Create legend item - display actual count
                const legendItem = document.createElement('li');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <span class="legend-color-box" style="background-color: ${color};"></span>
                    <span class="legend-text">${item.name}</span>
                    <span class="legend-value">${item.totalSold} ชิ้น</span> 
                `;
                legendContainer.appendChild(legendItem);
            });

            chartWrapper.style.background = `conic-gradient(${conicGradientString})`;
            centerCircle.textContent = largestSliceName || ''; // Display the best seller name in the center
        }


        // --- Products Tab Functions (จัดการเมนูสินค้า) ---
        function populateCategoryDropdown() {
            const select = document.getElementById("menuCategorySelect");
            select.innerHTML = ''; // Clear existing options

            // Add default "Select Category" option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '--- เลือกหมวดหมู่ ---';
            defaultOption.disabled = true;
            defaultOption.selected = true;
            select.appendChild(defaultOption);

            // Get unique categories and sort them
            const categories = [...new Set(products.map(p => p.category))].sort();

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });

            // Add "Add New Category" option
            const newCategoryOption = document.createElement('option');
            newCategoryOption.value = 'newCategory';
            newCategoryOption.textContent = '--- เพิ่มหมวดหมู่ใหม่ ---';
            select.appendChild(newCategoryOption);

            // Reset visibility of the new category input
            document.getElementById("newCategoryInput").style.display = 'none';
            document.getElementById("newCategoryInput").value = '';
        }

        function toggleNewCategoryInput() {
            const select = document.getElementById("menuCategorySelect");
            const newCategoryInput = document.getElementById("newCategoryInput");
            if (select.value === 'newCategory') {
                newCategoryInput.style.display = 'block';
                newCategoryInput.focus();
            } else {
                newCategoryInput.style.display = 'none';
                newCategoryInput.value = ''; // Clear input if not adding new
            }
        }

        function saveMenu() {
            // Remove empty categories before saving
            // Filter out categories with no items, unless it's a new, empty category being added
            // Ensure no duplicate categories by checking only if it's a new category being added and not existing.
            products = products.filter(group => group.items.length > 0 || (document.getElementById("newCategoryInput").value.trim() !== '' && group.category === document.getElementById("newCategoryInput").value.trim() && !products.some(p => p.category.toLowerCase() === document.getElementById("newCategoryInput").value.trim().toLowerCase() && p !== group)));

            localStorage.setItem('menuItems', JSON.stringify(products));
            
            // Automatically update both the menu list and product selection after saving
            renderMenuList();
            renderProductsForSales(); 
            populateCategoryDropdown(); // Re-populate dropdown to reflect any new/removed categories
        }

        function renderMenuList() {
            const tbody = document.getElementById("menuListTableBody");
            tbody.innerHTML = "";

            products.forEach((categoryGroup, categoryIndex) => {
                categoryGroup.items.forEach((item, itemIndex) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${categoryGroup.category}</td>
                        <td>${item.name}</td>
                        <td>${item.price}</td>
                        <td>
                            <button class="edit-btn" onclick="editMenuItem(${categoryIndex}, ${itemIndex})">แก้ไข</button>
                            <button class="delete-btn" onclick="deleteMenuItem(${categoryIndex}, ${itemIndex})">ลบ</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
        }

        function addMenuItem() {
            const categorySelect = document.getElementById("menuCategorySelect");
            const newCategoryInput = document.getElementById("newCategoryInput");
            
            let category = '';
            if (categorySelect.value === 'newCategory') {
                category = newCategoryInput.value.trim();
            } else {
                category = categorySelect.value;
            }

            const nameInput = document.getElementById("menuName").value.trim();
            const priceInput = parseFloat(document.getElementById("menuPrice").value);

            if (!category || !nameInput || isNaN(priceInput) || priceInput < 0) {
                alert("กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง");
                return;
            }

            // Check for duplicate category if it's a new one (case-insensitive)
            if (categorySelect.value === 'newCategory') {
                const categoryExists = products.some(group => group.category.toLowerCase() === category.toLowerCase());
                if (categoryExists) {
                    alert(`หมวดหมู่ '${category}' มีอยู่แล้ว`);
                    return;
                }
            }


            // Check for duplicate item name within the chosen/new category
            const existingCategory = products.find(group => group.category === category);
            if (existingCategory && existingCategory.items.some(item => item.name === nameInput)) {
                alert(`เมนู '${nameInput}' มีอยู่แล้วในหมวดหมู่ '${category}'`);
                return;
            }

            if (existingCategory) {
                existingCategory.items.push({ name: nameInput, price: priceInput });
            } else {
                products.push({ category: category, items: [{ name: nameInput, price: priceInput }] });
            }
            
            saveMenu(); // This will re-render all necessary components
            // Clear input fields
            categorySelect.value = ''; // Reset dropdown
            newCategoryInput.value = ''; // Clear new category input
            newCategoryInput.style.display = 'none'; // Hide new category input
            document.getElementById("menuName").value = '';
            document.getElementById("menuPrice").value = '0';
        }

        function editMenuItem(categoryIndex, itemIndex) {
            const categoryGroup = products[categoryIndex];
            const item = categoryGroup.items[itemIndex];

            const newName = prompt(`แก้ไขชื่อเมนู '${item.name}':`, item.name);
            if (newName === null) return; // User cancelled

            let newPrice = prompt(`แก้ไขราคา '${item.name}' (ปัจจุบัน ${item.price} บาท):`, item.price);
            if (newPrice === null) return; // User cancelled
            newPrice = parseFloat(newPrice);

            if (newName.trim() === "" || isNaN(newPrice) || newPrice < 0) {
                alert("กรุณากรอกข้อมูลให้ถูกต้อง");
                return;
            }

            // Check for duplicate name if name changed within the same category
            if (newName.trim() !== item.name) {
                if (categoryGroup.items.some((el, idx) => idx !== itemIndex && el.name === newName.trim())) {
                    alert(`เมนู '${newName.trim()}' มีอยู่แล้วในหมวดหมู่เดียวกัน`);
                    return;
                }
            }
            
            item.name = newName.trim();
            item.price = newPrice;
            
            saveMenu(); // This will re-render both lists
        }

        function deleteMenuItem(categoryIndex, itemIndex) {
            const itemToDelete = products[categoryIndex].items[itemIndex];
            if (!confirm(`คุณแน่ใจหรือไม่ที่ต้องการลบเมนู '${itemToDelete.name}'?`)) return;

            products[categoryIndex].items.splice(itemIndex, 1);
            
            // If the category becomes empty, remove the category itself
            if (products[categoryIndex].items.length === 0) {
                products.splice(categoryIndex, 1);
            }

            saveMenu(); // This will re-render both lists
        }

        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentDate();
            // Automatically switch to the "รายการขาย" tab on load
            switchTab('sales-tab'); // No need for event object here
        });
    </script>
</body>
</html>
